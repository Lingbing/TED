{
    "contents" : "#' Cluster detected events\n#' \n#' This function groups the detected events into clusters. The clustering is based on statistical characteristics of\n#' event.\n\n#' \n#' @param x a vector or time series\n#' @param a a vector consisting of the starting points of all the detected events\n#' @param b a vector consisting of the ending points of all the detected events\n#' @param k0 the number of clusters\n#' @export\n#' @examples\n#' set.seed(12345)\n#' n=128\n#' types=c('box','rc','cr','sine')\n#' shapes=matrix(NA,20,n)\n#' for (i in 1:20){\n#'   shapes[i,]=cbfs(type=types[sample(1:4,1)])\n#' }\n#' whitenoise=ts2mat(rnorm(128*20),128)\n#' x=c(rnorm(128),t(cbind(shapes,whitenoise)))\n#' plot(x,ty='l')\n#' w=128\n#' alpha=0.05\n#' events=eventDetection(x,w,alpha,'art')\n#' a=events$start\n#' b=events$end\n#' cc=eventCluster(x,a,b,4)\n#' myclkm=cc$cl\n\neventCluster<-function(x,a,b,k0){\n  eventmeasures=foreach (i=1:length(a),.combine=rbind) %dopar% {\n    event=x[a[i]:b[i]]\n    measures(event)\n  }  \n  tranmeasures=matrix(0,length(a),dim(eventmeasures)[2])\n  for (i in 1:dim(eventmeasures)[2]){\n    x=eventmeasures[,i]\n    if (min(x,na.rm=TRUE)<=0){\n      x=1+eventmeasures[,i]-min(eventmeasures[,i],na.rm=TRUE)\n    }else{\n      x=x}\n    tranmeasures[,i]=(x)^boxcoxfit(x)$lambda}\n  pc.cr <- princomp(scale(tranmeasures))\n  ratio_kmeans=rep(NA,100)\n  for (i in 1:100){\n    assign(paste('cc',i,sep=''),kmeans(pc.cr$scores[, 1:5],k0,iter.max=1000))\n    ratio_kmeans[i]=get(paste('cc',i,sep=''))$tot.withinss/get(paste('cc',i,sep=''))$totss}\n  index=which.min(ratio_kmeans)\n  cc=get(paste('cc',index,sep=''))\n  myclkm=cc$cluster\n  index=list()\n  center=matrix(NA,k0,dim(eventmeasures)[2])\n  for (i in 1:k0){\n    index[[i]]=which(myclkm==i)\n    if (!is.array(eventmeasures[index[[i]],])){\n      center[i,]=(eventmeasures[index[[i]],])\n    }else{ \n      center[i,]=colMeans(eventmeasures[index[[i]],])}}\n  colnames(center)=colnames(eventmeasures)\n  return(list(cl=myclkm,center=center))\n}",
    "created" : 1395556287422.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1049171617",
    "id" : "745BDBBE",
    "lastKnownWriteTime" : 1395562266,
    "path" : "~/Desktop/EventDetection/R/eventCluster.R",
    "project_path" : "R/eventCluster.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_source"
}