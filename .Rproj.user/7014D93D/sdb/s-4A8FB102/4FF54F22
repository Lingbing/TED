{
    "contents" : "library(R.matlab)\nCASES99=readMat('~/Documents/CASES99/cases99_1006.mat')\nCASES99T=CASES99$tc.1hz\ntemp2=CASES99T[1:82471,2]\ntemp7=CASES99T[1:82471,7]\nuspeed3=CASES99$u.fast.1hz[1:82471,3]\nuspeed1=CASES99$u.fast.1hz[1:82471,1]\nvspeed3=CASES99$v.fast.1hz[1:82471,3]\nvspeed1=CASES99$v.fast.1hz[1:82471,1]\nlibrary(doMC)\nlibrary(foreach)\nregisterDoMC(cores=8)\nw=120\ntemp7rnt=rntestspar(temp7,w)\nsh=shape_extraction0820(temp7,temp7rnt,w)\na=sh$start+w/4\nb=sh$end+w-1-w/4\nsave(a,b,temp2,temp7,uspeed3,uspeed1,vspeed3,vspeed1,file='JAS0910.Rdata')\n\nstability<-function(start,end){\n  g=9.8\n  z3=10\n  z1=1.5\n  load('~/Documents/Meetings_2013/0320/1006.Rdata')\n  theta7=mean(temp7[start:end],na.rm=TRUE)+0.01*9.5+273\n  theta2=mean(temp2[start:end],na.rm=TRUE)+0.01*0.63+273\n  Nsquare=g*(theta7-theta2)/theta2/(9.5-0.63)\n  Ssquare=(mean(uspeed3[start:end],na.rm=TRUE)-mean(uspeed1[start:end],na.rm=TRUE))^2/(z3-z1)^2+(mean(vspeed3[start:end],na.rm=TRUE)-mean(vspeed1[start:end],na.rm=TRUE))^2/(z3-z1)^2\n  R=Nsquare/Ssquare\n  if (is.na(R)){R=0}\n  if (R<(-10)){\n    R=-10\n  }else{\n    R=R\n  }\n  if (R>10){\n    R=10\n  }else{\n    R=R\n  }\n  \n  return(R)}\n\ncasemeasures=foreach (i=1:length(a),.combine=rbind) %dopar% {\n  measures0307_edited(temp7[(a[i]):(b[i])],a[i],b[i])\n}\n\nlibrary(geoR)\n\ntranmeasures=matrix(0,length(a),9)\n\nfor (i in 1:9){\n  x=casemeasures[,i]\n  if (min(x)<=0){\n    x=1+casemeasures[,i]-min(casemeasures[,i])\n  }else{\n    x=x}\n  tranmeasures[,i]=(x)^boxcoxfit(x)$lambda}\n\npc.cr <- princomp(scale(tranmeasures[,2:9]))\nhr <- hclust(dist(pc.cr$scores[, 1:5]),method='ward')\nmycl <- as.numeric(cutree(hr, k=6))\n#mycol <- c(gray(0.1),gray(0.3),gray(0.4),gray(0.5),gray(0.7),gray(0.85),gray(1))\nmycol <- sample(rainbow(10))\nmycol <- mycol[as.vector(mycl)]\nheatmap(pc.cr$scores[, 1:5], Rowv=as.dendrogram(hr), Colv=NA, RowSideColors=mycol,labRow='')  \n\n\n\n\ncln6=list()\nk=6\ncm6=matrix(NA,k,8)\nfor (i in 1:k){\n  cln6[[i]]=which(mycl==i)\n  if (!is.array(casemeasures[cln6[[i]],2:9])){\n    cm6[i,]=(casemeasures[cln6[[i]],2:9])\n  }else{ \n    cm6[i,]=colMeans(casemeasures[cln6[[i]],2:9])}}\ncolnames(cm6)=colnames(casemeasures)[2:9]\nresave(casemeasures,cln6,cm6,mycl,mycol,hr,pc.cr,file='JAS0910.Rdata')\n\nlevels=c(9.5,11.3,13.1,14.9,16.7,18.5,20.3,22.1,23.9,25.7,27.5,29.3,31.1,32.9,34.7,36.5,38.3,40.1,41.9,43.7,45.4,47.3,49.1,50.9,52.7,54.5,56.3,58.1)\nsource('~/Documents/Meetings/Rfunctions/Find_Max_CCF.R')\nload('~/Documents/Conferences&Presentations/JAS/JAS0910/JAS0910.Rdata')\n\nfor (i in 1:34){\n  assign(paste(\"CASES99T\",i,sep=\"\"),CASES99T[1:82471,i])\n}\nlibrary(fields)\ndepths=c()\ndepthmean=rep(NA,6)\ncors=matrix(0,6,27)\nlags=matrix(0,6,27)\nfor (j in 1:6){\n  cor=matrix(1,length(which(mycl==j)),27)\n  depth=rep(NA,length(which(mycl==j)))\n  lag=matrix(1,length(which(mycl==j)),27)\n  for (k in 1:length(which(mycl==j))){\n    ind=which(mycl==j)[k]\n    for (m in 8:34){\n      assign(paste('cor[',k,m-7,']',sep=''),as.numeric(Find_Max_CCF(get(paste(\"CASES99T\",7,sep=\"\"))[a[ind]:b[ind]],get(paste(\"CASES99T\",m,sep=\"\"))[a[ind]:b[ind]])[1]))\n      assign(paste('lag[',k,m-7,']',sep=''),as.numeric(Find_Max_CCF(get(paste(\"CASES99T\",3,sep=\"\"))[a[ind]:b[ind]],get(paste(\"CASES99T\",m,sep=\"\"))[a[ind]:b[ind]])[2]))\n      cor[k,m-7]=get(paste('cor[',k,m-7,']',sep=''))\n      lag[k,m-7]=get(paste('lag[',k,m-7,']',sep=''))\n      cors[j,]=colMeans(cor,na.rm=TRUE)\n      lags[j,]=colMeans(lag,na.rm=TRUE)}\n    signs=rep(NA,27)\n    \n    for (s in 8:33){\n      signs[s-7]=(cor[k,s-7] - 1/exp(1))*(cor[k,s+1-7] - 1/exp(1))}\n    \n    if (sum(cor[k,]>1/exp(1))==27){\n      inde=27}else{\n        inde=which(signs<0)[1]}\n    depth[k]=levels[inde+1]-levels[1] \n    if (is.na(depth[k])){\n      depth[k]=0\n    }\n    \n  }\n  \n  depthmean[j]=median(depth,na.rm=TRUE)\n  depths=c(depths,depth)}\n\ndepth=rep(NA,6)\nfor (i in 1:6){\n  signs=rep(NA,26)\n  for (s in 8:33){\n    signs[s-7]=(cors[i,s-7] - 1/exp(1))*(cors[i,s+1-7] - 1/exp(1))\n  }\n  if (sum(cors[i,]>1/exp(1))==27){\n    inde=27}else{\n      inde=which(signs<0)[1]}\n  depth[i]=levels[inde+1]-levels[1] \n  if (is.na(depth[i])){\n    depth[i]=0\n  }\n  plot(cors[i,],levels[2:28],type='l',xlab='Correlation',ylab='Height (m)',main=paste('Cluster',i,': Depth =',depth[i],'m'),xlim=c(0,1))\n  lines(cors[i,]-sd(cors[i,]),levels[2:28],lty=2)\n  lines(cors[i,]+sd(cors[i,]),levels[2:28],lty=2)\n  xline(1/exp(1),lty=3)\n  #axis(1, 1/exp(1), expression(1/e), col.axis = \"blue\")\n}\n\n### The table  ###\nRImeans=foreach (i = 1:6,.combine=c) %dopar%{\n  mean(casemeasures[which(mycl==i),1])\n}\n\nphaseangle=foreach (ind=1:102,.combine=rbind) %dopar% {\n  if (sum(is.na(wspeed3[(a[ind]):(b[ind])]))>0){\n    rep(NA,2)\n  }else{\n    lag_max=as.numeric(Find_Max_CCF(temp7[(a[ind]):(b[ind])],wspeed3[(a[ind]):(b[ind])])[2])\n    cor_max=as.numeric(Find_Max_CCF(temp7[(a[ind]):(b[ind])],wspeed3[(a[ind]):(b[ind])])[1])\n    \n    cor0=cor(temp7[(a[ind]):(b[ind])],wspeed3[(a[ind]):(b[ind])])\n    if (cor_max-cor0>0.5*cor0){\n      c(cor_max,lag_max)\n    }else{\n      c(cor0,0)\n    }\n  }\n}\n\nPAmeans=foreach (i = 1:6,.combine=rbind) %dopar%{\n  colMeans(phaseangle[which(mycl==i),],na.rm=TRUE)\n}\n\n\nlibrary(foreach)\nlibrary(fields)\nlibrary(doMC)\nregisterDoMC(cores=8)\nphi=0.9\nl=500\nvariance=1-phi^2\nset.seed(100)\na=seq(0,0.4,by=0.02)\nla=length(a)\nln=arima.sim(list(order = c(1,0,0),ar=phi),n=l,sd=sqrt(variance))\nnln=ln+0.2*(ln^2-1)\nla=length(a)\nPP=foreach (j=1:la) %dopar%{\n  P2=foreach(i =1:1000) %dopar%{\n    ln=arima.sim(list(order = c(1,0,0),ar=phi),n=l,sd=sqrt(variance))\n    nln=ln+a[j]*(ln^2-1)\n    model=ar.ols(nln,order.max=1)\n    p=Box.test(model$resid,lag=round(log(l)),type=\"Ljung-Box\",fitdf=1)$p.value\n    #xx=approx(c(1:w), xx,n=w*5)$y\n    if(pp.test(nln)$p.value>0.05){ \n      0\n    }else{\n      p\n    }\n  }\n  P2=as.numeric(P2)\n  sum(P2>0.05)/1000\n}\nPP=as.numeric(PP)\n",
    "created" : 1395548009858.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2922349088",
    "id" : "4FF54F22",
    "lastKnownWriteTime" : 1379427094,
    "path" : "~/Documents/Conferences&Presentations/JAS/JAS0910/JAS.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}